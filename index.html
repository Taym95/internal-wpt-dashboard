<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Servo WPT CSS scores</title>
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
        <script>
            google.charts.load('current', {packages: ['corechart', 'line']});
            google.charts.setOnLoadCallback(setupChart);

            const fetchData = fetch('scores.json');
            function setupChart() {
                let data = new google.visualization.DataTable();
                data.addColumn('date', 'runOn');
                data.addColumn('number', 'Score');

                let endOfYear = new Date(2023, 11, 31)
                let maxDate = new Date()
                if (maxDate > endOfYear) {
                    maxDate = endOfYear
                }

                let options = {
                    height: 350,
                    fontSize: 14,
                    tooltip: {
                        trigger: 'both',
                    },
                    hAxis: {
                        title: 'Date',
                        format: 'dd-MMM-YYYY',
                        viewWindow: {
                            max: maxDate
                        }
                    },
                    vAxis: {
                        title: `WPT Score`,
                        format: 'percent',
                        viewWindow: {
                            min: 0,
                            max: 1,
                        }
                    },
                    explorer: {
                        actions: ['dragToZoom', 'rightClickToReset'],
                        axis: 'horizontal',
                        keepInBounds: true,
                        maxZoomIn: 4.0,
                    },
                };


                let node = document.getElementById('servo-chart')
                let chart = new google.visualization.LineChart(node);

                fetchData
                    .then(resp => resp.json())
                    .then(scores => {
                        console.log(scores)
                        for (const row of scores.scores) {
                            const [y,m,d] = row[0].split('-')
                            data.addRow([
                                new Date(y, m - 1, d),
                                row[1] / 1000
                            ]);
                        }
                        chart.draw(data, options);
                    })

            }
        </script>
    </head>
    <body>
        <div id="servo-chart"></div>
    </body>
</html>
